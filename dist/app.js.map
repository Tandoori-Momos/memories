{"version":3,"sources":["../src/app.js"],"names":["app","use","express","static","__dirname","set","altPort","server","listen","process","env","PORT","console","log","address","port","io","on","socket","passportSetup","require","mongoose","connect","MONGODB_URL","useNewUrlParser","then","catch","err","maxAge","keys","COOKIE_KEY","passport","initialize","session","authRoutes"],"mappings":";;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAGA;;;;AACA;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAVA;AATA;;AAqBA,IAAMA,MAAM,wBAAZ;;AAEAA,IAAIC,GAAJ,CAAQC,kBAAQC,MAAR,CAAeC,YAAY,SAA3B,CAAR;AACAJ,IAAIK,GAAJ,CAAQ,OAAR,EAAiBD,YAAY,QAA7B;AACAJ,IAAIK,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAEA,IAAMC,UAAU,IAAhB;AACA,IAAMC,SAASP,IAAIQ,MAAJ,CAAWC,QAAQC,GAAR,CAAYC,IAAZ,IAAoBL,OAA/B,EAAwC,YAAM;AAC3DM,UAAQC,GAAR,CAAY,uBAAuBN,OAAOO,OAAP,GAAiBC,IAApD;AACD,CAFc,CAAf;;AAIA;AACA,IAAMC,KAAK,sBAAOT,MAAP,CAAX;AACAP,IAAIK,GAAJ,CAAQ,WAAR,EAAqBW,EAArB;;AAEAA,GAAGC,EAAH,CAAM,YAAN,EAAoB,UAASC,MAAT,EAAiB;AACnCN,UAAQC,GAAR,CAAY,mBAAZ;AACD,CAFD;;AAIA;AACA,IAAMM,gBAAgBC,QAAQ,wBAAR,CAAtB;;AAEA;AACAC,mBAASC,OAAT,CAAiBb,QAAQC,GAAR,CAAYa,WAA7B,EAA0C;AACxCC,mBAAiB;AADuB,CAA1C,EAEGC,IAFH,CAEQ,YAAM;AACZb,UAAQC,GAAR,CAAY,0BAAZ;AACD,CAJD,EAIGa,KAJH,CAIS,UAACC,GAAD,EAAS;AAChBf,UAAQC,GAAR,CAAYc,GAAZ;AACD,CAND;;AAQA;AACA3B,IAAIC,GAAJ,CAAQ,6BAAc;AACpB2B,UAAQ,KAAK,EAAL,GAAU,EAAV,GAAe,GADH,EACQ;AAC5BC,QAAM,CAACpB,QAAQC,GAAR,CAAYoB,UAAb;AAFc,CAAd,CAAR;;AAKA;AACA9B,IAAIC,GAAJ,CAAQ8B,mBAASC,UAAT,EAAR;AACAhC,IAAIC,GAAJ,CAAQ8B,mBAASE,OAAT,EAAR;;AAEA;AACA,sBAAOjC,GAAP;AACAA,IAAIC,GAAJ,CAAQ,OAAR,EAAiBiC,oBAAjB","file":"app.js","sourcesContent":["// npm modules\r\n\r\nimport express from 'express';\r\nimport ejs from 'ejs';\r\nimport cookieSession from 'cookie-session';\r\nimport passport from 'passport';\r\nimport mongoose from 'mongoose';\r\nimport socket from 'socket.io';\r\n\r\n// Routes\r\nimport routes from './routes.js';\r\nimport authRoutes from './routes/auth-routes.js';\r\n\r\n// The following order must be followed\r\n// for OAuth login to work:\r\n// i) cookieParser\r\n// ii) session\r\n// iii) passport.initialize\r\n// iv) passport.session\r\n// v) app.router\r\n\r\nconst app = express();\r\n\r\napp.use(express.static(__dirname + '/public'));\r\napp.set('views', __dirname + '/views');\r\napp.set('view engine', 'ejs');\r\n\r\nconst altPort = 8080;\r\nconst server = app.listen(process.env.PORT || altPort, () => {\r\n  console.log('Listening to port ' + server.address().port);\r\n});\r\n\r\n// Setup socket.io\r\nconst io = socket(server);\r\napp.set('socket.io', io);\r\n\r\nio.on('connection', function(socket) {\r\n  console.log('connection made! ');\r\n});\r\n\r\n// Setup OAuth for Google login\r\nconst passportSetup = require('./config/passportSetup');\r\n\r\n// Connect to remote database\r\nmongoose.connect(process.env.MONGODB_URL, {\r\n  useNewUrlParser: true\r\n}).then(() => {\r\n  console.log('connected to mongoose db');\r\n}).catch((err) => {\r\n  console.log(err);\r\n});\r\n\r\n// Setup cookies\r\napp.use(cookieSession({\r\n  maxAge: 24 * 60 * 60 * 100, // cookie will expire after 1 day\r\n  keys: [process.env.COOKIE_KEY]\r\n}));\r\n\r\n// Initialize passport\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\n\r\n// set up routes\r\nroutes(app);\r\napp.use('/auth', authRoutes);\r\n"]}